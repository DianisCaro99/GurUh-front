<nb-layout>
  <nb-layout-column>
    <div class="col-md-6 mx-auto">
      <nb-card>
        <nb-card-header>
          <h1 id="title" class="title text-center">Cambia tu contraseña</h1>
        </nb-card-header>
        <nb-card-body>
          <nb-auth-block class="mx-auto">
            <nb-alert
              *ngIf="showMessages.error && errors?.length && !submitted"
              outline="danger"
              role="alert"
            >
              <p class="alert-title">
                <b>{{ errors[0] }}</b>
              </p>
            </nb-alert>

            <nb-alert
              *ngIf="showMessages.success && messages?.length && !submitted"
              outline="success"
              role="alert"
            >
              <p class="alert-title">
                <b>{{ errors[0] }}</b>
              </p>
            </nb-alert>

            <form
              (ngSubmit)="resetPass()"
              #resetPassForm="ngForm"
              aria-labelledby="title"
            >
              <div class="form-control-group">
                <label class="label" for="input-password"
                  >Nueva contraseña:</label
                >
                <input
                  nbInput
                  [(ngModel)]="user.password"
                  #password="ngModel"
                  type="password"
                  id="input-password"
                  name="password"
                  class="first"
                  placeholder="Nueva contraseña"
                  autofocus
                  fullWidth
                  fieldSize="large"
                  [status]="
                    password.dirty
                      ? password.invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  required
                  minlength="8"
                  maxlength="20"
                  [attr.aria-invalid]="
                    password.invalid && password.touched ? true : null
                  "
                />
                <ng-container *ngIf="password.invalid && password.touched">
                  <p
                    class="caption status-danger"
                    *ngIf="password.errors?.required"
                  >
                    ¡Ingresa una contraseña!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="
                      password.errors?.minlength || password.errors?.maxlength
                    "
                  >
                    La nueva contraseña debe tener entre 8 y 20 caracteres
                  </p>
                </ng-container>
              </div>

              <div class="form-group">
                <label class="label" for="input-re-password"
                  >Confirmar nueva contraseña:</label
                >
                <input
                  nbInput
                  [(ngModel)]="user.passwordConfirm"
                  #rePass="ngModel"
                  id="input-re-password"
                  name="rePass"
                  type="password"
                  class="last"
                  placeholder="Confirma tu contraseña"
                  fullWidth
                  fieldSize="large"
                  [status]="
                    rePass.touched
                      ? rePass.invalid || password.value != rePass.value
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  required
                  [attr.aria-invalid]="
                    rePass.invalid && rePass.touched ? true : null
                  "
                />
                <ng-container *ngIf="rePass.touched">
                  <p
                    class="caption status-danger"
                    *ngIf="rePass.invalid && rePass.errors?.required"
                  >
                    ¡Ingresa nuevamente tu contraseña!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="
                      password.value != rePass.value && !rePass.errors?.required
                    "
                  >
                    ¡Las contraseñas no coinciden!
                  </p>
                </ng-container>
              </div>

              <button
                nbButton
                status="primary"
                fullWidth
                size="large"
                [disabled]="submitted || !resetPassForm.valid"
                [class.btn-pulse]="submitted"
              >
                Cambiar contraseña
              </button>
            </form>

            <section class="sign-in-or-up" aria-label="Sign in or sign up">
              <p>
                <a class="text-link" routerLink="../../login">Iniciar sesión</a>
              </p>
              <p><a class="text-link" routerLink="../../signup">Registro</a></p>
            </section>
          </nb-auth-block>
        </nb-card-body>
      </nb-card>
    </div>
  </nb-layout-column>
</nb-layout>
