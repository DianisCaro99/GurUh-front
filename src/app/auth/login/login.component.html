<nb-layout>
  <nb-layout-column>
    <div class="col-md-6 mx-auto">
      <nb-card>
        <nb-card-header>
          <h1 id="title" class="title text-center">Inicio de sesión</h1>
        </nb-card-header>
        <nb-card-body>
          <nb-auth-block class="mx-auto">
            <nb-alert
              *ngIf="showMessages.error && errors?.length && !submitted"
              outline="danger"
              role="alert"
            >
              <p class="alert-title">
                <b>{{ errors[0] }}</b>
              </p>
            </nb-alert>

            <nb-alert
              *ngIf="showMessages.success && messages?.length && !submitted"
              outline="success"
              role="alert"
            >
              <p class="alert-title"><b>Hooray!</b></p>
              <ul class="alert-message-list">
                <li *ngFor="let message of messages" class="alert-message">
                  {{ message }}
                </li>
              </ul>
            </nb-alert>

            <form (ngSubmit)="login()" #form="ngForm" aria-labelledby="title">
              <div class="form-control-group">
                <label class="label" for="input-email"
                  >Dirección de correo:</label
                >
                <input
                  nbInput
                  fullWidth
                  [(ngModel)]="user.email"
                  #email="ngModel"
                  name="email"
                  id="input-email"
                  pattern=".+@.+\..+"
                  placeholder="Correo electrónico"
                  fieldSize="large"
                  autofocus
                  [status]="
                    email.dirty
                      ? email.invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  required
                  [attr.aria-invalid]="
                    email.invalid && email.touched ? true : null
                  "
                />
                <ng-container *ngIf="email.invalid && email.touched">
                  <p
                    class="caption status-danger"
                    *ngIf="email.errors?.required"
                  >
                    Ingresa una dirección de correo!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="email.errors?.pattern"
                  >
                    Ingresa una dirección de correo válida!
                  </p>
                </ng-container>
              </div>

              <div class="form-control-group">
                <span class="label-with-link">
                  <label class="label" for="input-password">Contraseña:</label>
                  <a
                    class="forgot-password caption-2"
                    routerLink="../forgotpassword"
                    >¿Olvidaste tu contraseña?</a
                  >
                </span>
                <input
                  nbInput
                  fullWidth
                  [(ngModel)]="user.password"
                  #password="ngModel"
                  name="password"
                  type="password"
                  id="input-password"
                  placeholder="Contraseña"
                  fieldSize="large"
                  [status]="
                    password.dirty
                      ? password.invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  required
                  minlength="8"
                  maxlength="20"
                  [attr.aria-invalid]="
                    password.invalid && password.touched ? true : null
                  "
                />
                <ng-container *ngIf="password.invalid && password.touched">
                  <p
                    class="caption status-danger"
                    *ngIf="password.errors?.required"
                  >
                    Se requiere una contraseña!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="
                      password.errors?.minlength || password.errors?.maxlength
                    "
                  >
                    La contraseña debe tener entre 8 y 20 caracteres
                  </p>
                </ng-container>
              </div>

              <div class="form-control-group accept-group">
                <nb-checkbox
                  name="rememberMe"
                  [(ngModel)]="user.rememberMe"
                  *ngIf="rememberMe"
                  >Mantener</nb-checkbox
                >
              </div>

              <button
                nbButton
                fullWidth
                status="primary"
                size="large"
                [disabled]="submitted || !form.valid"
                [class.btn-pulse]="submitted"
              >
                Iniciar
              </button>
            </form>

            <section
              *ngIf="socialLinks && socialLinks.length > 0"
              class="links"
              aria-label="Social sign in"
            >
              O ingresa con:
              <div class="socials">
                <ng-container *ngFor="let socialLink of socialLinks">
                  <a
                    *ngIf="socialLink.link"
                    [routerLink]="socialLink.link"
                    [attr.target]="socialLink.target"
                    [attr.class]="socialLink.icon"
                    [class.with-icon]="socialLink.icon"
                  >
                    <nb-icon
                      *ngIf="socialLink.icon; else title"
                      [icon]="socialLink.icon"
                    ></nb-icon>
                    <ng-template #title>{{ socialLink.title }}</ng-template>
                  </a>
                  <a
                    *ngIf="socialLink.url"
                    [attr.href]="socialLink.url"
                    [attr.target]="socialLink.target"
                    [attr.class]="socialLink.icon"
                    [class.with-icon]="socialLink.icon"
                  >
                    <nb-icon
                      *ngIf="socialLink.icon; else title"
                      [icon]="socialLink.icon"
                    ></nb-icon>
                    <ng-template #title>{{ socialLink.title }}</ng-template>
                  </a>
                </ng-container>
              </div>
            </section>

            <section class="another-action" aria-label="Register">
              ¿No tienes una cuenta?
              <a class="text-link" routerLink="../signup">Registro</a>
            </section>
          </nb-auth-block>
        </nb-card-body>
      </nb-card>
    </div>
  </nb-layout-column>
</nb-layout>
